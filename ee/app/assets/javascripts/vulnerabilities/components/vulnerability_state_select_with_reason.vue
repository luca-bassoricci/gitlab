<script>
import { GlIcon } from '@gitlab/ui';
import { __ } from '~/locale';

const CUSTOM_REASON = __('Custom');

export default {
  name: 'VulnerabilityStateSelectWithReason',
  components: { GlIcon },
  props: {
    stateItem: {
      type: Object,
      required: true,
    },
    selectedReason: {
      type: String,
      required: true,
    },
    isSelected: {
      type: Boolean,
      required: true,
    },
  },
  computed: {
    displayReasons() {
      const res = this.stateItem.reasons.map((reason) => reason);
      if (this.hasCustomReason()) {
        res.push(__(CUSTOM_REASON));
      }
      return res;
    },
    displayReason() {
      let reason = this.selectedReason;
      if (this.hasCustomReason()) {
        reason = __(CUSTOM_REASON);
      }
      return reason;
    },
  },
  methods: {
    hasCustomReason() {
      return this.stateItem.reasons.indexOf(this.selectedReason) === -1;
    },
    triggerReasonChange(reason) {
      this.$emit('change', { stateItem: this.stateItem, reason });
    },
  },
};
</script>

<template>
  <ul class="pt-1 list-group-flush">
    <li
      v-for="(reason, idx) in displayReasons"
      :key="idx"
      class="list-group-item list-group-item-action pt-1"
      @click="triggerReasonChange(reason)"
    >
      <div :class="{ active: displayReason === reason && isSelected }">
        <gl-icon
          v-if="displayReason == reason && isSelected"
          class="selected-icon position-absolute mt-1"
          name="chevron-right"
          :size="16"
        />
        <div class="pt-1 pb-2 pl-4">{{ reason }}</div>
      </div>
    </li>
  </ul>
</template>
